<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SayÄ± Oyunu - Ã‡ok Oyunculu</title>
    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        .animate-fadeIn { animation: fadeIn 0.5s ease-out; }
        .animate-slideIn { animation: slideIn 0.3s ease-out; }
        .animate-bounce { animation: bounce 1s infinite; }
        .animate-pulse { animation: pulse 2s infinite; }
        .animate-shake { animation: shake 0.3s ease-in-out; }
        
        .chat-container {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .chat-container::-webkit-scrollbar {
            width: 8px;
        }
        
        .chat-container::-webkit-scrollbar-thumb {
            background: #9333ea;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const SOCKET_URL = 'http://localhost:3000';
        
        const AVATARS = ['ğŸ˜', 'ğŸ¤ ', 'ğŸ¥³', 'ğŸ¤–', 'ğŸ‘¾'];
        
        const THEMES = {
          default: {
            name: 'VarsayÄ±lan',
            gradient: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
            buttonColor: 'from-purple-500 to-pink-500'
          },
          fire: {
            name: 'AteÅŸ',
            gradient: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
            buttonColor: 'from-red-500 to-orange-500'
          },
          ocean: {
            name: 'Okyanus',
            gradient: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
            buttonColor: 'from-blue-500 to-cyan-500'
          },
          forest: {
            name: 'Orman',
            gradient: 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',
            buttonColor: 'from-green-500 to-teal-500'
          },
          sunset: {
            name: 'GÃ¼n BatÄ±mÄ±',
            gradient: 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
            buttonColor: 'from-pink-500 to-yellow-500'
          }
        };

        const LOSER_MESSAGES = [
          "Bakkala git paÅŸam! ğŸ›’",
          "Sen git, biz burada bekleriz! ğŸ˜‚",
          "AyÄ±p oldu ama, sen gidiyorsun! ğŸ¤£",
          "Kaybettik be abi, hadi yÃ¼rÃ¼! ğŸš¶",
          "BÃ¶yle kaybedenliÄŸi ilk defa gÃ¶rdÃ¼m! ğŸ’€",
          "Valla helal olsun, tam kaybettin! ğŸ˜…",
          "Git lan bakkala, ne duruyorsun! ğŸƒ",
          "Ã‡ay da alÄ±ver dÃ¶nÃ¼ÅŸte! â˜•",
          "Simit de var mÄ± bakar mÄ±sÄ±n? ğŸ¥¯",
          "YÃ¼rÃ¼ be, seninki belli oldu! ğŸ˜",
          "Hadi koÃ§um, yolun aÃ§Ä±k olsun! ğŸ¯",
          "Tam sen gidecek adamsÄ±n! ğŸ’ª",
          "BeleÅŸe gidersin bu sefer! ğŸ¤‘",
          "Ne kaybetmek ama, efsane! ğŸ”¥"
        ];

        function SayiOyunu() {
          const [socket, setSocket] = useState(null);
          const [gameState, setGameState] = useState('home');
          const [playerName, setPlayerName] = useState('');
          const [selectedAvatar, setSelectedAvatar] = useState('ğŸ˜');
          const [roomCode, setRoomCode] = useState('');
          const [roomPassword, setRoomPassword] = useState('');
          const [room, setRoom] = useState(null);
          const [myName, setMyName] = useState('');
          const [blockingOwnNumber, setBlockingOwnNumber] = useState(false);
          const [eliminationMessage, setEliminationMessage] = useState('');
          const [selectedTheme, setSelectedTheme] = useState('default');
          const [timerEnabled, setTimerEnabled] = useState(true);
          const [timeLeft, setTimeLeft] = useState(42);
          const [showSettings, setShowSettings] = useState(false);
          const [showChat, setShowChat] = useState(false);
          const [chatMessage, setChatMessage] = useState('');
          const [messages, setMessages] = useState([]);
          const [gameHistory, setGameHistory] = useState([]);
          const [showHistory, setShowHistory] = useState(false);
          const [loserMessage, setLoserMessage] = useState('');
          
          const chatEndRef = useRef(null);
          const timerRef = useRef(null);

          // Socket baÄŸlantÄ±sÄ±
          useEffect(() => {
            console.log('ğŸ”Œ Socket baÄŸlantÄ±sÄ± kuruluyor...');
            const newSocket = io(SOCKET_URL);
            setSocket(newSocket);

            newSocket.on('connect', () => {
              console.log('âœ… Socket baÄŸlandÄ±!', newSocket.id);
            });

            newSocket.on('roomCreated', ({ roomCode, playerName, avatar }) => {
              console.log('ğŸ‰ Oda oluÅŸturuldu:', roomCode, playerName);
              setRoomCode(roomCode);
              setMyName(playerName);
              setSelectedAvatar(avatar);
              setGameState('lobby');
              playSound('select');
            });

            newSocket.on('roomJoined', ({ roomCode, playerName, avatar }) => {
              console.log('ğŸ‘‹ Odaya katÄ±ldÄ±:', roomCode, playerName);
              setRoomCode(roomCode);
              setMyName(playerName);
              setSelectedAvatar(avatar);
              setGameState('lobby');
              playSound('select');
            });

            newSocket.on('updateRoom', (roomData) => {
              console.log('ğŸ“¡ Oda gÃ¼ncellendi:', roomData);
              setRoom(roomData);
              
              if (roomData.gameState === 'numberSelect' && gameState !== 'numberSelect') {
                console.log('ğŸ¯ SayÄ± seÃ§me ekranÄ±na geÃ§iliyor...');
                setGameState('numberSelect');
              } else if (roomData.gameState === 'playing' && gameState !== 'playing') {
                console.log('ğŸ® Oyun baÅŸlÄ±yor...');
                setGameState('playing');
                setTimeLeft(42);
              } else if (roomData.gameState === 'finished') {
                console.log('ğŸ Oyun bitti!');
                setGameState('result');
                if (timerRef.current) clearInterval(timerRef.current);
              }
            });

            newSocket.on('playerEliminated', (playerName) => {
              console.log('âœ¨ Oyuncu elendi:', playerName);
              playSound('eliminate');
              setEliminationMessage(playerName);
              
              confetti({
                particleCount: 50,
                spread: 60,
                origin: { y: 0.3 }
              });
              
              setTimeout(() => setEliminationMessage(''), 2000);
            });

            newSocket.on('noPlayerHadNumber', (number) => {
              console.log('âŒ Kimse seÃ§memiÅŸ:', number);
              playSound('click');
            });

            newSocket.on('gameFinished', (data) => {
              console.log('ğŸŠ Oyun sonuÃ§landÄ±:', data);
              
              const iAmLoser = data.loser === myName;
              const randomMessage = LOSER_MESSAGES[Math.floor(Math.random() * LOSER_MESSAGES.length)];
              setLoserMessage(randomMessage);
              
              if (iAmLoser) {
                playSound('lose');
                const duration = 2500;
                const end = Date.now() + duration;

                (function frame() {
                  confetti({
                    particleCount: 8,
                    angle: 60,
                    spread: 120,
                    origin: { x: 0, y: 0.6 },
                    colors: ['#000000', '#FF4500', '#FF6347', '#8B0000', '#FFA500', '#DC143C']
                  });
                  confetti({
                    particleCount: 8,
                    angle: 120,
                    spread: 120,
                    origin: { x: 1, y: 0.6 },
                    colors: ['#000000', '#FF4500', '#FF6347', '#8B0000', '#FFA500', '#DC143C']
                  });

                  if (Date.now() < end) {
                    requestAnimationFrame(frame);
                  }
                }());
              } else {
                const duration = 3500;
                const end = Date.now() + duration;

                (function frame() {
                  confetti({
                    particleCount: 4,
                    angle: 60,
                    spread: 60,
                    origin: { x: 0, y: 0.4 },
                    colors: ['#FF1493', '#00CED1', '#FFD700', '#7FFF00', '#FF69B4']
                  });
                  confetti({
                    particleCount: 4,
                    angle: 120,
                    spread: 60,
                    origin: { x: 1, y: 0.4 },
                    colors: ['#FF1493', '#00CED1', '#FFD700', '#7FFF00', '#FF69B4']
                  });

                  if (Date.now() < end) {
                    requestAnimationFrame(frame);
                  }
                }());
              }
            });

            newSocket.on('ownNumberBlocked', () => {
              console.log('â›” Kendi rakamÄ±nÄ± seÃ§meye Ã§alÄ±ÅŸtÄ±!');
              playSound('error');
              setBlockingOwnNumber(true);
              setTimeout(() => setBlockingOwnNumber(false), 800);
            });

            newSocket.on('newMessage', (message) => {
              setMessages(prev => [...prev, message]);
            });

            newSocket.on('gameHistory', (history) => {
              setGameHistory(history);
            });

            newSocket.on('error', (message) => {
              console.error('âŒ Hata:', message);
              alert(message);
            });

            newSocket.on('disconnect', () => {
              console.log('ğŸ”Œ BaÄŸlantÄ± koptu');
            });

            return () => {
              console.log('ğŸ”Œ Socket kapatÄ±lÄ±yor...');
              if (timerRef.current) clearInterval(timerRef.current);
              newSocket.close();
            };
          }, []);

          // Timer
          useEffect(() => {
            if (gameState === 'playing' && room && timerEnabled) {
              const currentPlayer = room.players[room.currentTurnIndex];
              const isMyTurn = currentPlayer?.name === myName;

              if (isMyTurn) {
                setTimeLeft(42);
                
                timerRef.current = setInterval(() => {
                  setTimeLeft(prev => {
                    if (prev <= 1) {
                      clearInterval(timerRef.current);
                      autoSelectNumber();
                      return 0;
                    }
                    return prev - 1;
                  });
                }, 1000);
              }

              return () => {
                if (timerRef.current) clearInterval(timerRef.current);
              };
            }
          }, [gameState, room?.currentTurnIndex]);

          // Chat scroll
          useEffect(() => {
            chatEndRef.current?.scrollIntoView({ behavior: 'smooth' });
          }, [messages]);

          const playSound = (type) => {
            try {
              const audioContext = new (window.AudioContext || window.webkitAudioContext)();
              const oscillator = audioContext.createOscillator();
              const gainNode = audioContext.createGain();
              
              oscillator.connect(gainNode);
              gainNode.connect(audioContext.destination);
              
              if (type === 'click') {
                oscillator.frequency.value = 800;
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.1);
              } else if (type === 'select') {
                oscillator.frequency.value = 1200;
                gainNode.gain.setValueAtTime(0.4, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.15);
              } else if (type === 'eliminate') {
                [0, 0.1, 0.2].forEach((time, i) => {
                  const osc = audioContext.createOscillator();
                  const gain = audioContext.createGain();
                  osc.connect(gain);
                  gain.connect(audioContext.destination);
                  osc.frequency.value = [600, 800, 1000][i];
                  gain.gain.setValueAtTime(0.3, audioContext.currentTime + time);
                  gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + time + 0.2);
                  osc.start(audioContext.currentTime + time);
                  osc.stop(audioContext.currentTime + time + 0.2);
                });
              } else if (type === 'error') {
                oscillator.frequency.value = 300;
                gainNode.gain.setValueAtTime(0.4, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.2);
              } else if (type === 'lose') {
                oscillator.frequency.value = 200;
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
              }
            } catch (e) {
              console.log('Ses Ã§alamadÄ±:', e);
            }
          };

          const createRoom = () => {
            console.log('ğŸ†• Oda oluÅŸturuluyor...', playerName.trim());
            if (playerName.trim() && socket) {
              const settings = {
                theme: selectedTheme,
                timerEnabled,
                password: roomPassword || null
              };
              socket.emit('createRoom', { playerName: playerName.trim(), avatar: selectedAvatar, settings });
            }
          };

          const joinRoom = () => {
            console.log('ğŸšª Odaya katÄ±lÄ±nÄ±yor...', roomCode.trim(), playerName.trim());
            if (playerName.trim() && roomCode.trim() && socket) {
              socket.emit('joinRoom', { 
                roomCode: roomCode.trim().toUpperCase(), 
                playerName: playerName.trim(), 
                avatar: selectedAvatar,
                password: roomPassword || null
              });
            }
          };

          const selectMode = (mode) => {
            console.log('ğŸ¯ Mod seÃ§ildi:', mode, 'Oda:', roomCode);
            if (socket && roomCode) {
              socket.emit('selectMode', { roomCode, mode });
              playSound('select');
            }
          };

          const selectNumber = (number) => {
            console.log('ğŸ”¢ SayÄ± seÃ§ildi:', number, myName);
            if (socket && roomCode && myName) {
              socket.emit('selectNumber', { roomCode, playerName: myName, number });
              playSound('click');
            }
          };

          const callNumber = (number) => {
            console.log('ğŸ“¢ Rakam sÃ¶ylendi:', number);
            if (socket && roomCode) {
              if (timerRef.current) clearInterval(timerRef.current);
              socket.emit('callNumber', { roomCode, number });
            }
          };

          const useJoker = () => {
            console.log('ğŸƒ Joker kullanÄ±lÄ±yor...');
            if (socket && roomCode && myName) {
              if (timerRef.current) clearInterval(timerRef.current);
              socket.emit('useJoker', { roomCode, playerName: myName });
              playSound('select');
            }
          };

          const autoSelectNumber = () => {
            if (!room) return;
            
            const myNumber = room.selectedNumbers[myName];
            const availableNumbers = [];
            
            for (let i = 1; i <= room.selectedMode; i++) {
              if (!room.calledNumbers.includes(i) && i !== myNumber) {
                availableNumbers.push(i);
              }
            }
            
            if (availableNumbers.length > 0) {
              const randomNum = availableNumbers[Math.floor(Math.random() * availableNumbers.length)];
              callNumber(randomNum);
            }
          };

          const sendMessage = () => {
            if (chatMessage.trim() && socket && roomCode && myName) {
              socket.emit('sendMessage', { roomCode, playerName: myName, text: chatMessage.trim() });
              setChatMessage('');
            }
          };

          const resetGame = () => {
            console.log('ğŸ”„ Oyun sÄ±fÄ±rlanÄ±yor...');
            if (socket && roomCode) {
              socket.emit('resetGame', roomCode);
              setGameState('lobby');
              setMessages([]);
              setLoserMessage('');
              playSound('click');
            }
          };

          const loadGameHistory = () => {
            if (socket && roomCode) {
              socket.emit('getGameHistory', roomCode);
              setShowHistory(true);
            }
          };

          const currentTheme = THEMES[selectedTheme] || THEMES.default;

          // ANA SAYFA
          if (gameState === 'home') {
            return (
              <div className="min-h-screen flex items-center justify-center p-4"
                   style={{ background: currentTheme.gradient }}>
                <div className="bg-white rounded-3xl p-8 shadow-2xl max-w-md w-full animate-fadeIn">
                  <h1 className="text-5xl font-black text-center mb-8 bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
                    ğŸ² SAYI OYUNU ğŸ²
                  </h1>
                  
                  <input
                    type="text"
                    value={playerName}
                    onChange={(e) => setPlayerName(e.target.value)}
                    placeholder="AdÄ±nÄ± gir..."
                    className="w-full px-4 py-3 text-xl border-4 border-purple-300 rounded-xl focus:border-purple-500 outline-none mb-4"
                  />

                  <div className="mb-4">
                    <p className="text-center text-gray-700 font-bold mb-2">Avatar SeÃ§:</p>
                    <div className="flex justify-center gap-3">
                      {AVATARS.map(avatar => (
                        <button
                          key={avatar}
                          onClick={() => setSelectedAvatar(avatar)}
                          className={`text-4xl p-2 rounded-xl transition-all ${
                            selectedAvatar === avatar 
                              ? 'bg-purple-500 scale-125' 
                              : 'bg-gray-200 hover:scale-110'
                          }`}
                        >
                          {avatar}
                        </button>
                      ))}
                    </div>
                  </div>

                  <button
                    onClick={() => setShowSettings(!showSettings)}
                    className="w-full py-2 bg-gray-200 text-gray-700 font-bold rounded-xl mb-4 hover:bg-gray-300 transition"
                  >
                    ğŸ® {showSettings ? 'Oda AyarlarÄ±nÄ± Gizle' : 'Oda AyarlarÄ±nÄ± GÃ¶ster'}
                  </button>

                  {showSettings && (
                    <div className="bg-gray-100 p-4 rounded-xl mb-4 space-y-3">
                      <div>
                        <label className="block text-sm font-bold mb-2">Tema:</label>
                        <select
                          value={selectedTheme}
                          onChange={(e) => setSelectedTheme(e.target.value)}
                          className="w-full px-3 py-2 border-2 border-gray-300 rounded-lg"
                        >
                          {Object.keys(THEMES).map(key => (
                            <option key={key} value={key}>{THEMES[key].name}</option>
                          ))}
                        </select>
                      </div>

                      <div className="flex items-center justify-between">
                        <label className="font-bold">SÃ¼re SÄ±nÄ±rÄ± (42sn):</label>
                        <input
                          type="checkbox"
                          checked={timerEnabled}
                          onChange={(e) => setTimerEnabled(e.target.checked)}
                          className="w-6 h-6"
                        />
                      </div>

                      <div>
                        <label className="block text-sm font-bold mb-2">Oda Åifresi (Ä°steÄŸe BaÄŸlÄ±):</label>
                        <input
                          type="password"
                          value={roomPassword}
                          onChange={(e) => setRoomPassword(e.target.value)}
                          placeholder="BoÅŸ bÄ±rakabilirsiniz"
                          className="w-full px-3 py-2 border-2 border-gray-300 rounded-lg"
                        />
                      </div>
                    </div>
                  )}

                  <div className="space-y-4">
                    <button
                      onClick={createRoom}
                      disabled={!playerName.trim()}
                      className={`w-full py-4 bg-gradient-to-r ${currentTheme.buttonColor} text-white text-2xl font-bold rounded-xl hover:scale-105 transition-transform shadow-lg disabled:opacity-50 disabled:cursor-not-allowed`}
                    >
                      YENÄ° ODA OLUÅTUR
                    </button>

                    <div className="relative">
                      <div className="absolute inset-0 flex items-center">
                        <div className="w-full border-t border-gray-300"></div>
                      </div>
                      <div className="relative flex justify-center text-sm">
                        <span className="px-2 bg-white text-gray-500">VEYA</span>
                      </div>
                    </div>

                    <input
                      type="text"
                      value={roomCode}
                      onChange={(e) => setRoomCode(e.target.value.toUpperCase())}
                      placeholder="Oda Kodu"
                      className="w-full px-4 py-3 text-xl border-4 border-purple-300 rounded-xl focus:border-purple-500 outline-none text-center font-bold"
                      maxLength="6"
                    />

                    <input
                      type="password"
                      value={roomPassword}
                      onChange={(e) => setRoomPassword(e.target.value)}
                      placeholder="Åifre (Varsa)"
                      className="w-full px-4 py-3 text-xl border-4 border-purple-300 rounded-xl focus:border-purple-500 outline-none text-center"
                    />

                    <button
                      onClick={joinRoom}
                      disabled={!playerName.trim() || !roomCode.trim()}
                      className={`w-full py-4 bg-gradient-to-r ${currentTheme.buttonColor} text-white text-2xl font-bold rounded-xl hover:scale-105 transition-transform shadow-lg disabled:opacity-50 disabled:cursor-not-allowed`}
                    >
                      ODAYA KATIL
                    </button>
                  </div>
                </div>
              </div>
            );
          }

          // LOBÄ°
          if (gameState === 'lobby' && room) {
            const isHost = room.players[0]?.name === myName;

            return (
              <div className="min-h-screen flex items-center justify-center p-4"
                   style={{ background: THEMES[room.theme || 'default'].gradient }}>
                <div className="bg-white rounded-3xl p-8 shadow-2xl max-w-md w-full">
                  <div className="text-center mb-6">
                    <h2 className="text-3xl font-bold text-gray-800 mb-2">ODA KODU</h2>
                    <div className="text-6xl font-black text-purple-600 tracking-wider mb-4">
                      {roomCode}
                    </div>
                    {room.password && <p className="text-sm text-gray-500">ğŸ”’ Åifreli Oda</p>}
                    <p className="text-gray-600">ArkadaÅŸlarÄ±na bu kodu ver!</p>
                  </div>

                  <div className="mb-6">
                    <h3 className="text-2xl font-bold text-gray-800 mb-4 text-center">
                      ğŸ‘¥ Oyuncular ({room.players.length})
                    </h3>
                    <div className="space-y-2">
                      {room.players.map((player, idx) => (
                        <div
                          key={idx}
                          className="flex items-center justify-between p-4 bg-gradient-to-r from-blue-100 to-purple-100 rounded-xl"
                        >
                          <span className="text-xl font-bold text-gray-800">
                            {player.avatar} {idx === 0 ? 'ğŸ‘‘ ' : ''}{player.name}
                          </span>
                          {player.name === myName && (
                            <span className="bg-green-500 text-white px-3 py-1 rounded-full text-sm font-bold">
                              SEN
                            </span>
                          )}
                        </div>
                      ))}
                    </div>
                  </div>

                  {room.timerEnabled && (
                    <div className="mb-4 p-3 bg-yellow-100 rounded-xl text-center">
                      <p className="text-sm font-bold text-yellow-800">â±ï¸ SÃ¼re SÄ±nÄ±rÄ±: 42 saniye</p>
                    </div>
                  )}

                  {isHost && room.players.length >= 2 && (
                    <div className="space-y-4">
                      <p className="text-center text-gray-700 font-bold mb-2">Oyun modunu seÃ§:</p>
                      {[31, 51, 101].map((num) => (
                        <button
                          key={num}
                          onClick={() => selectMode(num)}
                          className="w-full py-4 text-3xl font-bold rounded-xl transform transition-all hover:scale-105 shadow-lg"
                          style={{
                            background: num === 31 ? 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)' :
                                       num === 51 ? 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)' :
                                       'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',
                            color: 'white'
                          }}
                        >
                          1 - {num} OYNA
                        </button>
                      ))}
                    </div>
                  )}

                  {!isHost && (
                    <p className="text-center text-gray-600 text-lg">
                      ğŸ‘‘ Oda sahibi oyunu baÅŸlatacak...
                    </p>
                  )}

                  {room.players.length < 2 && (
                    <p className="text-center text-gray-500">
                      En az 2 oyuncu gerekli
                    </p>
                  )}

                  <button
                    onClick={loadGameHistory}
                    className="w-full mt-4 py-2 bg-gray-200 text-gray-700 font-bold rounded-xl hover:bg-gray-300 transition"
                  >
                    ğŸ“Š Oyun GeÃ§miÅŸi
                  </button>

                  {showHistory && (
                    <div className="mt-4 p-4 bg-gray-100 rounded-xl max-h-60 overflow-y-auto">
                      <h4 className="font-bold mb-2">GeÃ§miÅŸ Oyunlar:</h4>
                      {gameHistory.length === 0 ? (
                        <p className="text-gray-500 text-sm">HenÃ¼z oyun oynanmadÄ±</p>
                      ) : (
                        gameHistory.map((game, idx) => (
                          <div key={idx} className="mb-2 p-2 bg-white rounded">
                            <p className="text-sm"><strong>Oyun {idx + 1}</strong></p>
                            <p className="text-xs text-green-600">Kazananlar: {game.winners.join(', ')}</p>
                            <p className="text-xs text-red-600">Kaybeden: {game.loser}</p>
                          </div>
                        ))
                      )}
                    </div>
                  )}
                </div>
              </div>
            );
          }

          // SAYI SEÃ‡ME EKRANI
          if (gameState === 'numberSelect' && room) {
            const numbers = Array.from({ length: room.selectedMode }, (_, i) => i + 1);
            const rows = [];
            for (let i = 0; i < numbers.length; i += 10) {
              rows.push(numbers.slice(i, i + 10));
            }

            const hasSelected = room.selectedNumbers[myName] !== undefined;
            const allSelected = Object.keys(room.selectedNumbers).length === room.players.length;

            return (
              <div className="min-h-screen p-4"
                   style={{ background: 'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)' }}>
                <div className="max-w-4xl mx-auto">
                  <div className="text-center mb-8">
                    <h2 className="text-4xl font-black text-purple-600 mb-2">
                      {hasSelected ? 'âœ“ SeÃ§imini YaptÄ±n!' : 'Bir SayÄ± SeÃ§'}
                    </h2>
                    <p className="text-xl text-gray-700">
                      ğŸ¤« Gizlice seÃ§! (1 - {room.selectedMode})
                    </p>
                    <p className="text-lg text-gray-600 mt-2">
                      {Object.keys(room.selectedNumbers).length} / {room.players.length} oyuncu seÃ§ti
                    </p>
                  </div>

                  <div className="bg-white rounded-3xl p-6 shadow-2xl">
                    {rows.map((row, rowIdx) => (
                      <div key={rowIdx} className="flex flex-wrap justify-center gap-3 mb-3">
                        {row.map((num) => {
                          const isSelected = room.selectedNumbers[myName] === num;

                          return (
                            <button
                              key={num}
                              onClick={() => !hasSelected && !isSelected && selectNumber(num)}
                              disabled={hasSelected || isSelected}
                              className={`w-16 h-16 text-2xl font-bold rounded-full transition-all ${
                                isSelected || hasSelected
                                  ? 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                  : 'bg-gradient-to-br from-yellow-400 to-orange-500 text-white hover:scale-125 active:scale-95 shadow-lg'
                              }`}
                            >
                              {num}
                            </button>
                          );
                        })}
                      </div>
                    ))}
                  </div>

                  {allSelected && (
                    <div className="text-center mt-6 animate-bounce">
                      <p className="text-3xl font-black text-green-600">
                        ğŸ® Oyun BaÅŸlÄ±yor...
                      </p>
                    </div>
                  )}
                </div>
              </div>
            );
          }

          // OYUN EKRANI - SABÄ°T LAYOUT
          if (gameState === 'playing' && room) {
            const numbers = Array.from({ length: room.selectedMode }, (_, i) => i + 1);
            const currentPlayer = room.players[room.currentTurnIndex];
            const isMyTurn = currentPlayer?.name === myName;
            const myNumber = room.selectedNumbers[myName];
            const hasJoker = room.jokers && room.jokers[myName] > 0;

            const rows = [];
            for (let i = 0; i < numbers.length; i += 10) {
              rows.push(numbers.slice(i, i + 10));
            }

            return (
              <div className="min-h-screen p-4"
                   style={{ background: 'linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)' }}>
                <div className="max-w-4xl mx-auto">

                  {blockingOwnNumber && (
                    <div className="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 animate-shake">
                      <div className="bg-red-500 text-white px-12 py-8 rounded-3xl shadow-2xl text-center">
                        <p className="text-5xl font-black mb-2">â›” YASAK! â›”</p>
                        <p className="text-2xl font-bold">Kendi rakamÄ±nÄ± seÃ§emezsin!</p>
                      </div>
                    </div>
                  )}

                  {eliminationMessage && (
                    <div className="fixed top-20 left-1/2 transform -translate-x-1/2 z-50 animate-fadeIn">
                      <div className="bg-gradient-to-r from-green-400 to-blue-500 text-white px-12 py-6 rounded-3xl shadow-2xl text-center">
                        <p className="text-4xl font-black">ğŸ‰ {eliminationMessage} ğŸ‰</p>
                        <p className="text-xl mt-2">KURTULDU!</p>
                      </div>
                    </div>
                  )}

                  {/* OYUNCU LÄ°STESÄ° - SABÄ°T YÃœKSEK */}
                  <div className="mb-4" style={{ minHeight: '60px' }}>
                    <div className="flex flex-wrap gap-3 justify-center">
                      {room.players.map((player, idx) => {
                        const isEliminated = room.eliminatedPlayers.includes(player.name);
                        const isTurn = idx === room.currentTurnIndex;

                        return (
                          <div
                            key={idx}
                            className={`px-4 py-2 rounded-2xl font-bold text-lg transition-all ${
                              isEliminated
                                ? 'bg-gray-300 text-gray-500 line-through'
                                : isTurn
                                ? 'bg-gradient-to-r from-yellow-400 to-orange-500 text-white shadow-2xl animate-pulse'
                                : 'bg-white text-gray-800 shadow-lg'
                            }`}
                          >
                            {player.avatar} {isEliminated ? 'âœ“ ' : isTurn ? 'ğŸ‘‰ ' : ''}{player.name}
                          </div>
                        );
                      })}
                    </div>
                  </div>

                  {/* SIRA BÄ°LGÄ°SÄ° - SABÄ°T YÃœKSEK */}
                  <div className="text-center mb-4" style={{ minHeight: '100px' }}>
                    <h2 className="text-3xl font-black text-purple-600">
                      {isMyTurn ? 'SENÄ°N SIRAN! ğŸ¯' : `${currentPlayer?.name}'Ä±n SÄ±rasÄ±`}
                    </h2>
                    <p className="text-lg text-gray-700 mt-1">
                      {isMyTurn ? 'Bir rakam seÃ§' : 'Bekle...'}
                    </p>
                  </div>

                  {/* TÄ°MER + JOKER - SABÄ°T YÃœKSEK (YAN YANA) */}
                  <div className="flex justify-center items-center gap-6 mb-4" style={{ minHeight: '80px' }}>
                    {isMyTurn && room.timerEnabled && (
                      <div className={`text-4xl font-black ${timeLeft <= 10 ? 'text-red-600 animate-pulse' : 'text-green-600'}`}>
                        â±ï¸ {timeLeft}
                      </div>
                    )}

                    {isMyTurn && hasJoker && (
                      <button
                        onClick={useJoker}
                        className="px-6 py-3 bg-gradient-to-r from-yellow-400 to-yellow-600 text-white text-xl font-bold rounded-xl hover:scale-110 transition-transform shadow-lg"
                      >
                        ğŸƒ JOKER ({room.jokers[myName]})
                      </button>
                    )}
                  </div>

                  {/* RAKAM TABLOSU */}
                  <div className="bg-white rounded-3xl p-6 shadow-2xl mb-6">
                    {rows.map((row, rowIdx) => (
                      <div key={rowIdx} className="flex flex-wrap justify-center gap-3 mb-3">
                        {row.map((num) => {
                          const isCalled = room.calledNumbers.includes(num);
                          const isOwnNumber = isMyTurn && num === myNumber;

                          return (
                            <button
                              key={num}
                              onClick={() => isMyTurn && !isCalled && callNumber(num)}
                              disabled={!isMyTurn || isCalled}
                              className={`w-16 h-16 text-2xl font-bold rounded-full transition-all ${
                                isCalled
                                  ? 'bg-gray-300 text-gray-500 cursor-not-allowed line-through'
                                  : isOwnNumber
                                  ? 'bg-red-400 text-white cursor-not-allowed opacity-50'
                                  : !isMyTurn
                                  ? 'bg-gray-200 text-gray-400 cursor-not-allowed'
                                  : 'bg-gradient-to-br from-purple-400 to-pink-500 text-white hover:scale-125 active:scale-95 shadow-lg'
                              }`}
                            >
                              {num}
                            </button>
                          );
                        })}
                      </div>
                    ))}
                  </div>

                  {/* CHAT BUTONU */}
                  <button
                    onClick={() => setShowChat(!showChat)}
                    className="fixed bottom-6 right-6 w-16 h-16 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-full shadow-2xl hover:scale-110 transition-transform text-2xl z-40"
                  >
                    ğŸ’¬
                  </button>

                  {/* CHAT PENCERE */}
                  {showChat && (
                    <div className="fixed bottom-24 right-6 w-80 bg-white rounded-2xl shadow-2xl p-4 z-40">
                      <div className="flex justify-between items-center mb-3">
                        <h3 className="font-bold text-lg">Chat</h3>
                        <button onClick={() => setShowChat(false)} className="text-2xl">âœ•</button>
                      </div>
                      
                      <div className="chat-container mb-3 space-y-2">
                        {messages.map((msg, idx) => (
                          <div key={idx} className={`p-2 rounded-lg text-sm ${
                            msg.type === 'system' 
                              ? 'bg-gray-100 text-gray-600 italic text-center'
                              : msg.playerName === myName
                              ? 'bg-blue-500 text-white ml-8'
                              : 'bg-gray-200 text-gray-800 mr-8'
                          }`}>
                            {msg.type === 'player' && <strong>{msg.playerName}: </strong>}
                            {msg.text}
                          </div>
                        ))}
                        <div ref={chatEndRef} />
                      </div>

                      <div className="flex gap-2">
                        <input
                          type="text"
                          value={chatMessage}
                          onChange={(e) => setChatMessage(e.target.value)}
                          onKeyPress={(e) => e.key === 'Enter' && sendMessage()}
                          placeholder="Mesaj yaz..."
                          className="flex-1 px-3 py-2 border-2 border-gray-300 rounded-lg text-sm"
                        />
                        <button
                          onClick={sendMessage}
                          className="px-4 py-2 bg-blue-500 text-white font-bold rounded-lg hover:bg-blue-600"
                        >
                          â¤
                        </button>
                      </div>
                    </div>
                  )}
                </div>
              </div>
            );
          }

          // SONUÃ‡ EKRANI
          if (gameState === 'result' && room) {
            const loser = room.players.find(p => !room.eliminatedPlayers.includes(p.name));
            const iAmLoser = loser?.name === myName;

            return (
              <div className="min-h-screen flex items-center justify-center p-4"
                   style={{ background: 'linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)' }}>
                <div className="text-center">
                  {!iAmLoser && (
                    <div className="bg-white rounded-3xl p-8 shadow-2xl mb-6 animate-fadeIn">
                      <span className="text-9xl animate-bounce inline-block">ğŸ†</span>
                      <h3 className="text-4xl font-black text-green-600 mb-4 mt-4">
                        KAZANANLAR
                      </h3>
                      <div className="space-y-2">
                        {room.eliminatedPlayers.map((winnerName, idx) => {
                          const winner = room.players.find(p => p.name === winnerName);
                          return (
                            <p key={idx} className="text-3xl font-bold text-gray-800">
                              {winner?.avatar} âœ“ {winnerName}
                            </p>
                          );
                        })}
                      </div>
                    </div>
                  )}

                  <div className="bg-white rounded-3xl p-8 shadow-2xl mb-8 animate-fadeIn">
                    <span className="text-7xl">ğŸ’£ğŸ’¥</span>
                    <h3 className="text-5xl font-bold text-red-600 mb-2 mt-4">
                      {loser?.avatar} {loser?.name}
                    </h3>
                    <p className="text-3xl text-gray-700 font-bold">KAYBETTÄ°!</p>
                    <p className="text-2xl text-gray-600 mt-2">{loserMessage}</p>
                  </div>

                  <button
                    onClick={resetGame}
                    className="px-12 py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-2xl font-bold rounded-xl hover:scale-110 transition-transform shadow-lg"
                  >
                    YENÄ° OYUN
                  </button>
                </div>
              </div>
            );
          }

          return (
            <div className="min-h-screen flex items-center justify-center" style={{ background: currentTheme.gradient }}>
              <div className="text-center">
                <p className="text-4xl text-white font-bold mb-4">YÃ¼kleniyor...</p>
                <p className="text-2xl text-white">(Durum: {gameState})</p>
              </div>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SayiOyunu />);
    </script>
</body>
</html>